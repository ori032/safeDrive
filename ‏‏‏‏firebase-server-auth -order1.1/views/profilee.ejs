<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile page 2</title>
  <script src="profilee.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js" defer></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <title>Dashboard Template for Bootstrap</title>


  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">




</head>

<body>
  <nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0">
    <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="#">Drive Safe</a>
    <!-- <input class="form-control form-control-dark w-100" type="text" placeholder="Search" aria-label="Search"> -->
    <ul class="navbar-nav px-3">
      <li class="nav-item text-nowrap">
        <a class="nav-link" href="/sessionLogout">Sign out</a>
      </li>
    </ul>
  </nav>

  <div class="container-fluid">
    <div class="row">
      <nav class="col-md-2 d-none d-md-block bg-light sidebar ">
        <div class="position-fixed">
          <ul class="nav flex-column">
            <li class="nav-item " >
              <a class="nav-link active" href="#">
                <span data-feather="home"></span>
                Dashboard
              </a>
            </li>
            <li class="nav-item">
              <a type="button" id="CamerasMenu" class="nav-link">
                <span data-feather="file"></span>
                Cameras menu</a>
            </li>

            <li class="nav-item">
              <a type="button" onclick="drawChart()" class="nav-link">
                <span data-feather="file"></span>
                Chart
              </a>
            </li>

            <li class="nav-item">
              <a type="button" href="/profile" class="nav-link">
                <span data-feather="file"></span>
                Profile
              </a>
            </li>

            <li class="nav-item">
              <a type="button" id="editCameras" class="nav-link" >
                <span data-feather="video"></span>
                Edit Cameras
              </a>
            </li>
            <li class="nav-item">
              <a type="button" id="customers" class="nav-link" href="#">
                <span data-feather="users"></span>
                Customers
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">
                <span data-feather="bar-chart-2"></span>
                Reports
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">
                <span data-feather="layers"></span>
                Integrations
              </a>
            </li>
          </ul>

        </div>
      </nav>

      <main role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4">
        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
          <h1 class="h2">Dashboard</h1>
          <div class="btn-toolbar mb-2 mb-md-0">
            <div class="btn-group mr-2">
              <button class="btn btn-sm btn-outline-secondary">Share</button>
              <button class="btn btn-sm btn-outline-secondary">Export</button>
            </div>
            <button class="btn btn-sm btn-outline-secondary dropdown-toggle">
              <span data-feather="calendar"></span>
              This week
            </button>
          </div>
        </div>



        <!-- <canvas class="my-4" id="myChart"></canvas> -->
       

        <div class="d-flex align-content-center flex-wrap justify-content-around" id="buttonContainer"></div>

        <div>
          <div class="nav-item" id="container"> </div>
        </div>


<!-- 
        <h2>Section title</h2>
        <div class="table-responsive">
          <table class="table table-striped table-sm">
            <thead>
              <tr>
                <th>#</th>
                <th>time</th>
                <th>massage</th>
                <th>status</th>
                <th>Header</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>1,003</td>
                <td>libero</td>
                <td>Sed</td>
                <td>cursus</td>
                <td>ante</td>
              </tr>
              <tr>
                <td>1,004</td>
                <td>dapibus</td>
                <td>diam</td>
                <td>Sed</td>
                <td>nisi</td>
              </tr>
              <tr>
                <td>1,006</td>
                <td>nibh</td>
                <td>elementum</td>
                <td>imperdiet</td>
                <td>Duis</td>
              </tr>
            </tbody>
          </table>
        </div> -->
      </main>
    </div>
  </div>







  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
    integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script>
  <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery-slim.min.js"><\/script>')</script>
  <!-- <script src="../../assets/js/vendor/popper.min.js"></script> -->
  <!-- <script src="../../dist/js/bootstrap.min.js"></script> -->

  <!-- Icons -->
  <script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script>
  <script>
    feather.replace()
  </script>

  <!-- Graphs -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.7.1/dist/Chart.min.js"></script>
  <script>
    function clearcCntainer(container) {
      var div = document.getElementById(container);

      while (div.firstChild) {
        div.removeChild(div.firstChild);
      }
    }

    function drawChart() {
      console.log(Cookies.get('id'))
      clearcCntainer("container");

      var canvas = document.createElement('canvas');
      div = document.getElementById("container");
      canvas.class = "my-4";
      canvas.id = "myChart";


      div.appendChild(canvas)



      var ctx = document.getElementById("myChart");
      // ctx.width="900";
      // ctx.height="380"
      var myChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
          datasets: [{
            data: [15339, 21345, 18483, 24003, 23489, 24092, 12034],
            lineTension: 0,
            backgroundColor: 'transparent',
            borderColor: '#007bff',
            borderWidth: 4,
            pointBackgroundColor: '#007bff'
          }]
        },
        options: {
          scales: {
            yAxes: [{
              ticks: {
                beginAtZero: false
              }
            }]
          },
          legend: {
            display: false,
          }
        }
      });
    }

  </script>

  <!-- <script>

    async function drawCamerasEditButton() {
      drawSpiner("buttonContainer")

      try {
        var camerasArr = await postRequestToServer("/dbServer/getCamerasOfUser");
        console.log(camerasArr);
      } catch (err) {
        console.log(err.message);
        return;
      }

      clearcCntainer("container");
      clearcCntainer("buttonContainer");

      var container = document.getElementById('buttonContainer');

      var button = createAddCameraCard("camera", (function () { return console.log(camera) }));
      container.appendChild(button);

      camerasArr.forEach((camera) => {
        var onclickFunck = (function () { return console.log(camera) });
        var button = createDeleteCameraCard(camera, onclickFunck);

        // button.addEventListener("submit", (event) => {
        //   event.preventDefault();
        //   const login = event.target.email.value;
        //   console.log(login)
        // })

        container.appendChild(button);

      });
    }

    function createDeleteCameraCard(camera, onclickFunck) {
      var div = document.createElement('div');
      div.className = "card text-white bg-secondary mb-3"
      div.style = "width: 18rem;"

      var cardHeader = document.createElement('div')
      cardHeader.className = "card-header"
      cardHeader.innerHTML = camera

      div.appendChild(cardHeader)



      var cardBody = document.createElement('div')
      cardBody.className = "card-body"

      div.appendChild(cardBody);


      var form = document.createElement('form')
      form.className = "form-group"
      cardBody.appendChild(form);


      // var input = document.createElement('input')
      // input.id = "camera"
      // form.appendChild(input);


      var button = document.createElement('input');
      button.type = 'submit';
      button.value = "Delete camera";
      button.className = "form-control"

      form.appendChild(button);

      var cardText = document.createElement('p');
      cardText.className = "card-text"


      button.className = 'btn btn-primary';

      // button.onclick = onclickFunck;
      form.addEventListener("submit", async (event) => {
        event.preventDefault();
        // const camera = event.target.camera.value;
        // console.log(camera)
        // console.log(camera)

        try {
          var tittleTravelsArr = await postRequestToServer("/dbServer/deleteCamera", JSON.stringify({ cameraId: camera }));
          console.log(tittleTravelsArr);
        } catch (err) {
          console.log(err.message);
          return;

        }
        drawCamerasEditButton()
      })


      cardBody.appendChild(cardText);
      return div;

    }

    function createAddCameraCard(camera, onclickFunck) {
      var div = document.createElement('div');
      div.className = "card text-white bg-secondary mb-3"
      div.style = "width: 18rem;"

      var cardHeader = document.createElement('div')
      cardHeader.className = "card-header"
      cardHeader.innerHTML = "Adding a new camera"

      div.appendChild(cardHeader)



      var cardBody = document.createElement('div')
      cardBody.className = "card-body"

      div.appendChild(cardBody);


      var form = document.createElement('form')
      form.className = "form-group"
      cardBody.appendChild(form);


      var input = document.createElement('input')
      input.id = "camera"
      input.className = "form-text text-muted"
      form.appendChild(input);


      var button = document.createElement('input');
      button.type = 'submit';
      button.value = "Add camera";
      button.className = "form-control"

      form.appendChild(button);

      var cardText = document.createElement('p');
      cardText.className = "card-text"


      button.className = 'btn btn-primary';


      // button.onclick = onclickFunck;
      form.addEventListener("submit", async (event) => {
        event.preventDefault();
        const camera = event.target.camera.value;
        console.log(camera)
        console.log(name)

        try {
          var tittleTravelsArr = await postRequestToServer("/dbServer/updateCamera", JSON.stringify({ cameraId: camera }));
          console.log(tittleTravelsArr);
        } catch (err) {
          console.log(err.message);
          return;

        }
        drawCamerasEditButton()
      })


      cardBody.appendChild(cardText);
      return div;

    }

  </script>

  <script>

    function drawSpiner(container) {
      clearcCntainer(container)
      var container = document.getElementById('buttonContainer');
      var loadingP = document.createElement('p');
      loadingP.className = "btn btn-primary";
      var loadingSpan = document.createElement('span');
      loadingSpan.className = "spinner-border spinner-border-sm";
      loadingP.innerHTML = "Loading...";

      loadingP.appendChild(loadingSpan);
      container.appendChild(loadingP)

    }


    async function drawAllCamerasButton() {
      drawSpiner("buttonContainer")




      // var buttonsArr = ['camera_5', 'camera_6', 'camera_7', 'camera_8', 'camera_23', 'camera_24'];

      try {
        var camerasArr = await postRequestToServer("/dbServer/getCamerasOfUser");
        console.log(camerasArr);
      } catch (err) {
        console.log(err.message);
        return;
      }
      var container = document.getElementById('buttonContainer');

      clearcCntainer("container");
      clearcCntainer("buttonContainer");


      camerasArr.forEach((camera) => {
        var onclickFunck = (function () { return drawAllTittleTravelsButton(camera) });
        var button = createCameraCard(camera, onclickFunck);


        container.appendChild(button);
      });
      console.log("aaaa");

    }

    async function drawAllTittleTravelsButton(camera) {
      clearcCntainer("container");
      var container = document.getElementById(camera);






      console.log(camera)
      try {
        var tittleTravelsArr = await postRequestToServer("/dbServer/getTittleTravels", JSON.stringify({ cameraId: camera }));
        console.log(tittleTravelsArr);
      } catch (err) {
        console.log(err.message);
        return;

      }


      if ((tittleTravelsArr.length) < 1) {
        var cardText = document.getElementById(`card-text ${camera}`);
        cardText.innerHTML = "no travels";
        return;
      }


      tittleTravelsArr.forEach((tittleTravel) => {
        console.log(tittleTravel)
        console.log(tittleTravel["numberOfTravel"])

        var button = document.createElement('input');
        button.type = 'button';
        button.id = 'submit';
        button.value = "show travel " + tittleTravel["numberOfTravel"];
        // button.className = 'btn';
        button.class = "btn btn-outline-success"

        button.onclick = (async function () {
          console.log(camera)
          try {
            var travelsArr = await postRequestToServer("/dbServer/getTravels", JSON.stringify({ cameraId: camera, travelId: tittleTravel["numberOfTravel"] }));
            console.log(travelsArr);
          } catch (err) {
            console.log(err.message);
            return;

          }
        });

        container.appendChild(button);
      });

    }



    function createCameraCard(name, onclickFunck) {
      var div = document.createElement('div');
      div.className = "card text-white bg-secondary mb-3"
      div.style = "width: 18rem;"
      div.id = name

      var cardHeader = document.createElement('div')
      cardHeader.className = "card-header"
      cardHeader.innerHTML = name

      div.appendChild(cardHeader)



      var cardBody = document.createElement('div')
      cardBody.className = "card-body"

      div.appendChild(cardBody);


      var cardText = document.createElement('p');
      cardText.className = "card-text"
      cardText.id = `card-text ${name}`


      var button = document.createElement('input');
      button.type = 'button';
      button.id = 'submit';
      button.value = "Show travels";


      button.className = 'btn btn-primary';


      button.onclick = onclickFunck;

      cardBody.appendChild(button);
      cardBody.appendChild(cardText);
      return div;

    }

    function postRequestToServer(path, body = "") {
      return new Promise((resolve, reject) => {
        fetch(path, {
          method: "POST",
          headers: {
            Accept: "application/json",
            "Content-Type": "application/json",
            "CSRF-Token": Cookies.get("XSRF-TOKEN"),
          },
          body: body,
        }).then(response => response.json())

          .then(json => {
            resolve(json);
          })
          .catch(err => {
            console.log(err.message)
            reject(err)
          });
      })
    }
  </script> -->
</body>

</html>